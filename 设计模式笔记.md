# 设计模式

#### 设计模式概述

##### 设计模式概述（一）

- 模式是在特定环境下人们解决某类重复出现问题的一套成功或有效的解决方案。（A pattern is a successful or efficient solution to a recurring problem within a context）
- 在软件开发生命周期的每一个阶段都存在着一些被认同的模式。
- 设计模式用于在特定的条件下为一些重复出现的软件设计问题提供合理的、有效的解决方案。

##### 设计模式概述（二）

- 设计模式的一般定义：

  ```
  设计模式（Design Pattern）是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结，使用设计模式是为了可重用代码、让代码更容易被他人理解并且保证代码可靠性。
  ```

- 设计模式的关键要素是模式名称、问题、解决方案和效果

  - **模式名称（Pattern Name）** 通过一两个词来描述模式的问题、解决方案和效果，以便更好地理解模式并方便开发人员之间的交流，绝大多数模式都是根据其功能或模式结构来命名的；
  - **问题（Problem）** 描述了应该在何时使用模式，它包含了设计🀄️存在的问题以及问题存在的原因；
  - **解决方案（Solution）** 描述了一个设计模式的组成成分，以及这些组成成分之间的相互关系，各自的职责和协作方式，通常解决方案通过 UML 类图和核心代码来进行描述；
  - **效果（Consequences）** 描述了模式的优缺点以及在使用模式时应权衡的问题。

- 创建型模式主要用于描述如何创建对象，结构型模式主要用于描述如何实现类或对象的组合，行为型模式主要用于描述类或对象怎样交互以及怎样分配职责。

##### 设计模式概述（三）

- 在学习每一个设计模式时至少应该掌握如下几点：这个设计模式的意图是什么，它要解决一个什么问题，什么时候可以使用它；它是如何解决的，掌握它的结构图，记住它的关键代码；能够想到至少两个它的应用实例，一个生活中的，一个软件中的；这个模式的优缺点是什么，在使用时要注意什么。
- **少说多做。**
- 设计模式的“上乘”境界：“手中无模式，心中有模式”。

#### 面向对象设计原则

##### 概述

- 如何同时提高一个软件系统的可维护性和可复用性是面向对象设计需要解决的核心问题之一。
- 面向对象设计原则为支持可维护性复用而诞生，这些原则蕴含在很多设计模式🀄️，它们是从许多设计方案🀄️总结出的指导性原则。

##### 单一职责原则

- ```
  单一职责原则（Single Responsibility Principle，SRP）：一个类只负责一个功能领域中的相应职责，或者可以定义为：就一个类而言，应该只有一个引起它变化的原因。
  ```

- 单一职责原则是实现高内聚、低耦合的指导方针，它是最简单但又最难运用的原则。

##### 开闭原则

- ```
  开闭原则（Open-Closed Principle，OCP）：一个软件实体应当对扩展开放，对修改关闭。即软件实体应尽量在不修改原有代码的情况下进行扩展。
  ```

- 在开闭原则的定义🀄️，软件实体可以🈯️一个软件模块、一个由多个类组成的局部结构或一个独立的类。

- 抽象化是开闭原则的关键。

##### 里氏代换原则

- ```
  里氏代换原则（Liskov Substitution Principle，LSP）：所有引用基类（父类）的地方必须能透明地使用其子类的对象。
  ```

- 在软件🀄️将一个基类对象替换成它的子类对象，程序将不会产生任何错误和异常，反过来则不成立，如果一个软件实体使用的是一个子类对象的话，那么它不一定能够使用基类对象。

- 在程序🀄️尽量使用基类类型来对对象进行定义，而在运行时再确定其子类类型，用子类对象来替换父类对象。

- 里氏代换原则是实现开闭原则的重要方式之一。

##### 依赖倒转原则

- ```
  依赖倒转原则（Dependency Inversion Principle，DIP）：抽象不应该依赖于细节，细节应当依赖于抽象。换言之，要针对街口编程，而不是针对实现编程。
  ```

- 依赖倒转原则要求我们正程序代码🀄️传递参数时或在关联关系🀄️，尽量引用层次高的抽象层类，即使用接口和抽象类进行变量类型声明、参数类型声明、方法返回类型声明，以及数据类型的转换等，而不要用具体类来做这些事情。

- 依赖注入是🈯️当一个对象要与其他对象发生依赖关系时，通过抽象来注入所依赖的对象。

- 构造注入，设值注入（Setter 注入）和 接口注入

##### 接口隔离原则

- ```
  接口隔离原则（Interface Segregation Principle，ISP）：使用多个专门的接口，而不使用单一的总接口，即客户端不应该依赖那些它不需要的接口。
  ```

- 每一个接口应该承担一种相对独立的角色，不干不该干的事，该干的事都要干。

- ISP：接口仅仅提供客户端需要的行为，客户端不需要的行为则隐藏起来，应当为客户端提供尽可能小的单独的接口，而不要提供大的总接口。

- 在使用接口隔离原则时，我们需要注意控制接口的粒度，接口不能太小，如果太小会导致系统🀄️接口泛滥，不利于维护；接口也不能太大，太大的接口将违背接口隔离原则，灵活性较差，使用起来很不方便。

##### 合成复用原则

- ```
  合成复用原则（Composite Reuse Principle，CRP）：尽量使用对象组合，而不是继承来达到复用的目的。
  ```

- 复用时尽量使用组合／聚合关系（关联关系），少用继承。

- 需要慎重使用继承复用。

- 一般而言，如果两个类之间是 “Has-A” 的关系应使用组合或聚合，如果是 “Is-A” 关系可使用继承。

##### 迪米特法则

- ```
  迪米特法则（Law of Demeter，LoD）：一个软件实体应当尽可能少地与其他实体发生相互作用。
  ```

- 迪米特法则🉑️降低系统的耦合度，使类与类之间保持松散的耦合关系。

- 在设计系统时，应该尽量减少对象之间的交互，如果两个对象之间不必彼此直接通信，那么这两个对象就不应当发生任何直接的相互作用，如果其中的一个对象需要调用另一个对象的某一个方法等话，可以通过第三者转发这个调用。简而言之，就是通过引入一个合理的第三者来降低现有对象之间的耦合度。

- 在类的划分上，应当尽量创建松耦合的类，类之间的耦合度越低，就越有利于复用，一个处在松耦合🀄️的类一旦被修改，不会对关联的类造成太大波及；在类的结构设计上，每一个类都应当尽量降低其成员变量和成员函数的访问权限；在类的设计上，只要有可能，一个类应当设计成不变类；在对其他类的引用上，一个对象对其他对象的引用应当将到最低。